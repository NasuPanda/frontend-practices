# 第10章 Reactにおけるルーティング

# 10-1. SPAにおけるルーティングとは

## 通常のルーティング vs SPAにおけるルーティング

通常のMPAであれば、ルーティングとは「リクエストされたURLに対して、それに紐づく適切なコンテンツをアプリケーションサーバがクライアントに返す」こと。

それに対して、SPAのルーティングは、サーバへの初回のリクエストに対して、そのURLに関わらず、アプリケーション全体が記述されたJavaScriptのコードの塊・アセットファイルが返される。
それ以降のアプリケーション内部でのページ遷移は、アプリケーションが動的にDOMを書き換えることで移動しているように見えるだけ。
処理はブラウザ内で完結する。アドレスバーのURLが書き換わることがあっても、サーバへリクエストが飛ぶことは原則無い。

SPAにおけるルーティングを再定義しておくと、「DOMの動的な書き換えによってページ遷移を擬似的に実現するとともに、ブラウザのセッション履歴をそれに同期させること」

### 開発における注意点

サーバへリクエストが行かないということは、サーバ側からはクライアントがどのページを見ているか、ページをどう移動したかが分からないということ。

これは、Google Analytics などを使ったアクセス解析を行う上でネックになる。
このソリューションとしては、ルーティングが実行されたURLが書き換わる際に Effect Hook で Google Analytics にリクエストを発行する処理を差し込むといった方法がある。

サーバがHTTPステータスコードを返せない点にも注意が必要。

また、ルーティングの適用単位がコンポーネントだということも前提知識として知っておく必要がある。
Rails だと 一つのURLに対応するのは Controller でそれが view を経由してページ全体を描写するが、 React の場合はルートのコンポーネントから階層を下りていく。

# 10-2. ルーティングライブラリの選定

React向けのルーティングライブラリは、現状は [React Router](https://reactrouter.com/en/main) がデファクトスタンダード。
二番手は Reach Router 。

React Native の世界で最もメジャーなライブラリとして React Navigation もある。

## React Router のバージョンのお話

React Router, Reach Router はどちらも React Training 社のプロダクト。
競合ライブラリを同じ開発元が開発しているという謎な状況。

どちらを使えば良いのかという話だが、2019年5月、CEOの Ryan Florence が Reach Router を React Router に将来的には統合するという表明を出している。
シェアトップも React Router なので、基本的には React Router を使っておけば問題ない。

ただし、使用するバージョンには注意が必要。
React Router は、バージョン5 => 6 にかけてインターフェースを React Router に寄せるための破壊的変更を加えている。

現時点ではバージョン5系で開発されたプロダクトの方が多いので、ひとまず5系についても学んでおくべき。
ただし、今から新しくプロジェクトを始めるとしたら6系を選んでおけば間違いない。

