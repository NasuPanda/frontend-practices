# 8. 何はなくともコンポーネント

# 8-1. コンポーネントのメンタルモデル

## おさらい

Reactは「コンポーネント」という**見た目と機能をカプセル化した再利用可能なパーツ**を組み合わせることでアプリケーションを作る、コンポーネントベースアーキテクチャを採用している。

Reactは仮想DOMをリアルなDOMにレンダリングすることで動作する。
その仮想DOMを構成するのが React Elements。 React Elements はコンポーネントを任意の props でコールするための実行リンクのようなもの。

Scratch のようなビジュアルプログラミングは、用意されたビジュアルブロックをドラッグしてきてロジックの実体に起き、そこに各種パラメータを設定する。
そのイメージで、ブロックの実体がコンポーネント、ロジックの画面にパラメータ付きで置かれたブロックの仮身が React Elements。

## コンポーネントのイメージ

コンポーネントは、JavaScriptの関数のようなものと考えるのが一番近い。
props を引数として受け取り、返り値として React Elements を返す関数。

ただし、コンポーネントが通常の関数と違うのは、個々に「状態」を持つことが出来る点。これを state と呼ぶ。
props か state が変更されれば、コンポーネントのレンダリングに差分が発生する。

仮想DOMの再レンダリングも同じ考え方で理解できる。
Reactの差分検出エンジンは、仮想DOM内の React Elements を全て監視していて、そのどれかの props または 保持している state の値に差分を検出すると、そのコンポーネントのレンダリング処理を再実行する。

たとえばブラウザ上で何らかのイベントが発生し、そこに対応している React Elements の state が 変化したとする。
すると差分検出処理エンジンがそれを検知、新しい state でそのコンポーネント関数を再実行する。
その結果、戻り値の React Elements も変更が生じ、子要素としてコールしていたコンポーネントやその props の値が変わる。
そしてそれらのコンポーネントが新しい props で実行され、、、

といった形でその再レンダリングの波が子孫の要素に連鎖していく。
イメージとしてはぷよぷよに近い。
