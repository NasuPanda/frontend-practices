# 5. JSXでUIを表現する

# 5-1. なぜReactはJSXを使うのか

## JSXの本質を理解する

JSXとは、RailsにおけるERBのようなテンプレート言語・・・ではない。

JSXと言う名前は、「JavaScript」と「XML」の組み合わせで出来てる。JSXはXMLライクな記述ができるようにしたECMAScript2015に対する構文拡張。
Babel や tsc によりコンパイルされることを前提としたシンタックスシュガー。

例えば、以下のような形で変換される。

```jsx
// JSX
<button type="submit" autoFocus>
  Click Here
</button>
```

```js
// JS
React.createElement(
  'button',
  { type: 'submit', autoFocus: true },
  'Click Here'
);
```

JSXがやっているのは、 `React.createElement` というメソッドのコールへの変換を前提として、XMLタグとその組み合わせによるノードツリーをJavaScriptの中でシームレスに書けるようにすること。
`React.createElement` は、 TypeScriptでは `ReactElement` というインターフェースを下敷きにしたオブジェクトになる。
つまりJSXの構文は、本質的には `ReactElement` オブジェクトを表現するためのJavaScriptの拡張リテラル。

→ JSXはJavaScriptにおいては単なるオブジェクトを表現する式に還元されるものであって、特別な存在ではない。

### 構文拡張とは

言語標準には含まれない特殊用途のための便利な構文を、後づけで使えるようにしたもの。

## フレームワーク・ライブラリの人気度を比較したい時

色々やり方はあるが、DL数を見るのが最も確実。
「Googleトレンドに載っていた」というのは参考にならない。

何故なら、無駄に複雑・決まりごとが多いが故に検索数が増えているだけであることも多いため。

## なぜReactは見た目とロジックを混在させるのか

### コンポーネント: 機能単位にパーツを分割する

Reactでは、関心の分離の単位が**アプリケーションの機能**になっている。
独立した機能単位のパーツとして分割するためには、パーツの中に見た目とロジックを閉じ込める必要がある。

### MVCパターン

RORに代表されるサーバーサイドのフレームワークは、そのほとんどがMVCアーキテクチャを採用している。
(= 見た目とロジックを分離させている)

ソフトウェア工学において、アーキテクチャやデザインパターンは **関心の分離** を行うためにある。
MVCでは **技術の役割** の関心を分離している。

**技術のによって関心を分離する** というのは1時代を築いた考え方ではあるが、普遍的な真理ではない。
特にフロントエンド開発では、MVCパターンは上手く機能しないと言う見方が主流になっている。

### テンプレート形式 vs JSX

テンプレート形式は初見はとっつきやすく見えるが、複雑なアプリケーションを構成しようとすると「呪い」のせいでDXが低下していく。

- フレームワーク独自の制御構文や各種バインディングなどの暗黙の文脈といったものを大量に用意せざるを得なくなる。
  - 複雑なアプリケーションを開発しようと思うと決まりごとが次から次へと出てきて、それを覚える必要に迫られる。
- コンポーネントをテンプレート / ロジックで分けて書いてしまうと、コンポーネントが肥大化したときに分割しにくく、リファクタリングの障害になる。
- フレームワークによるコンパイルを挟むため、エラーがわかりにくくなる。
- 型推論が難しい。

## なぜReactはViewをタグツリーで表現するのか

JSXが表記にタグを用いるのはテンプレート形式を模倣してHTMLを直接書くためというより、単にXMLの記法がUIを表現するのに適しているからというニュアンスの方が強い。
アプリケーションを構成するコンポーネントを表現するには各種の属性値を持ったオブジェクトのノードツリーを用いるのが最適で、それをコードで視覚的に表現するのに最も優れているのが囲みタグ形式だったというだけ。

JSXは、XML全般を表現するためのもの。
Reactがオープンソースとして公開された直後に投稿された公式ブログの記事 [Why did we build React?](https://reactjs.org/blog/2013/06/05/why-react.html) を読むと、「HTML is just the beginning」というくだりがある。
それを読むと、Reactは当初からレンダラーを本体から分離する設計になっていて、レンダラーを入れ替えることで様々なプラットフォームのアプリケーションやドキュメントを表現出来るようにしようとしていた事がわかる。

現在、React用のレンダラーの中で活発に開発されているものを以下に示す。

- React DOM  ...... HTML DOM(公式標準パッケージ)
- react-test-renderer ......JavaScriptオブジェクト(公式標準パッケージ)
- ReactART ......HTML5CanvasやSVGなどのベクターグラフィック(公式標準パッケージ)
- React Native  ...... iOS および Android のネイティブアプリケーション
- React Native for Windows + macOS  ...... Windows および macOS のネイティブアプリケ ーション
- React 360  ...... ブラウザ上で動く VR アプリケーション
- React-pdf ......PDFドキュメント
- react-three-fiber ......WebGLによる3Dグラフィック

これらは別バージョンのReactというわけではなく、コア部分は共通、その仮想DOMを view に反映させるレンダラーのバリエーションということ。

つまり React とはWebに留まらず、アプリケーションやドキュメントを包括的に抽象化するもの。それを各プラットフォームに合わせて具現化するためのものがレンダラー。
そしてこれらレンダラーの共通記述言語がJSX。

Webフロントエンド開発で主に使うのは HTML DOMのレンダラーであるReact DOM。
1行目がReactコア本体を、2行目がReact DOMレンダラーをインポートしている。

```tsx:src/index.tsx
import React from 'react';
import ReactDom from 'react-dom';
// ...
ReactDOM.render(<App />, document.getElementById('root'));
```
